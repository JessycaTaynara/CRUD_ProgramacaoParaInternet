<!DOCTYPE html>
<html>
<head>
  <title>Gatitos Para Adotar</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css">
</head>
<body>
  <header class="text-white py-3" style="background-color: #D291BC;">
    <nav class="navbar navbar-expand-lg p-3 d-flex justify-content-around align-items-center" style="background-color: #D291BC;">
      <div class="d-flex align-items-center">
        <img width="64" height="64" src="icons8-gato-64.png" alt="gatinho" class="mr-3">
        <form class="form-inline">
          <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" id="pesquisa" onkeyup="buscarGatos()">
        </form>
      </div>
      <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#modal1">Adicionar gato</button>
      <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#modal1">Meus Gatos Adotados</button>
    </nav>
  </header>
  <main class="mt-4">
    <div class="container d-flex flex-wrap justify-content-around">
      <div class="card" style="width: 18rem;">
        <div class="card-body  d-flex flex-column">
          <h5 class="card-title">Antônio</h5>
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Idade
              <span class="badge bg-primary rounded-pill">14</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Sexo
              <span class="badge bg-primary rounded-pill">Macho</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Raça
              <span class="badge bg-primary rounded-pill">Viralata</span>
            </li>
          </ul>
          <button type="button" class="btn btn-secondary mb-2 mt-2">Adote</button>
          <button type="button" class="btn btn-secondary">Edite</button>
        </div>
      </div>
    </div>
  </main>
  <div class="modal fade" id="modal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Cadastre um gatinho</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex align-items-center mb-2">
            <label for="nome" class="form-label">Nome:</label>
            <input type="text" class="form-control" id="nome">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="raca" class="form-label">Raça:</label>
            <input type="text" class="form-control" id="raca">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="idade" class="form-label">Idade:</label>
            <input type="text" class="form-control" id="idade">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="sexo" class="form-label">Sexo:</label>
            <input type="text" class="form-control" id="sexo">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="cor" class="form-label">Cor:</label>
            <input type="text" class="form-control" id="cor">
          </div class="d-flex align-items-center mb-2">
            <label for="descricao" class="form-label">Descreva o Gatinho:</label>
            <input type="textarea" class="form-control" id="descricao">
          <div>

          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="addGato()">Salvar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="modal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Cadastre um gatinho</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal2" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex align-items-center mb-2">
            <label for="nome" class="form-label">Nome:</label>
            <input type="text" class="form-control" id="nomee">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="raca" class="form-label">Raça:</label>
            <input type="text" class="form-control" id="racaa">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="idade" class="form-label">Idade:</label>
            <input type="text" class="form-control" id="idadee">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="sexo" class="form-label">Sexo:</label>
            <input type="text" class="form-control" id="sexoo">
          </div>
          <div class="d-flex align-items-center mb-2">
            <label for="cor" class="form-label">Cor:</label>
            <input type="text" class="form-control" id="corr">
          </div>
        </div class="d-flex align-items-center mb-2">
          <label for="descricaoo" class="form-label">Descreva o Gatinho:</label>
          <input type="textarea" class="form-control" id="descricaoo">
        <div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="editarGato()" id="botaoEnviar">Salvar alteração</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  <script>
    exibirGatos();
    async function addGato(){
      var nome = document.getElementById("nome").value;
      var sexo = document.getElementById("sexo").value;
      var idade = document.getElementById("idade").value;
      var raca = document.getElementById("raca").value;
      var cor = document.getElementById("cor").value;
      var decricao = document.getElementById("descricao").value;

      var gato = {
        nome: nome,
        sexo: sexo,
        idade: idade,
        raca: raca,
        cor: cor == undefined? "" : cor,
        descricao: decricao
      };
      try{
        const r = await fetch('https://649a1d4a79fbe9bcf8404b5a.mockapi.io/users/20201214010034/products', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(gato)
        })
      }catch(error) {
      console.error('Erro ao adicionar gato:', error);
      };

      document.getElementById("nome").value = "";
      document.getElementById("sexo").value = "";
      document.getElementById("idade").value = "";
      document.getElementById("raca").value = "";
      document.getElementById("cor").value = "";
      document.getElementById("descricao").value = "";

      exibirGatos()
      
      const m = document.querySelector("#modal1");
      const modal = bootstrap.Modal.getInstance(m);
      modal.hide();
    }
    async function exibirGatos() {
      try{
        var r = await fetch('https://649a1d4a79fbe9bcf8404b5a.mockapi.io/users/20201214010034/products')
        const gatos = await r.json();
        const caixa = document.querySelector('div.container');
        caixa.innerHTML="";
        gatos.forEach(gato => {
          console.log(gatos)
          caixa.innerHTML += `
          <div class="card" style="width: 18rem;">
            <div class="card-body  d-flex flex-column">
              <h5 class="card-title">${gato.nome}</h5>
              <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Idade
                  <span class="badge bg-primary rounded-pill">${gato.idade}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Sexo
                  <span class="badge bg-primary rounded-pill">${gato.sexo}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Raça
                  <span class="badge bg-primary rounded-pill">${gato.raca}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Cor
                  <span class="badge bg-primary rounded-pill">${gato.cor}</span>
                </li>
                <li class="list-group-item d-flex flex-column justify-content-between align-items-center">
                  <strong>Descrição:</strong><br>
                  <p>${gato.descricao}</p>
                </li>
              </ul>
              <button type="button" class="btn btn-secondary mb-2 mt-2" onclick="adotar(${gato.id})">Adote</button>
              <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#modal2" onclick="editarGato(${gato.id})">Edite</button>
            </div>
          </div>
          `
        });
        
      }catch(error) {
        console.error(error);
      }
    }
    async function adotar(id) {
      try{
        var resposta = await fetch('https://649a1d4a79fbe9bcf8404b5a.mockapi.io/users/20201214010034/products/' + id, { method: "DELETE" });
        exibirGatos();
      }catch(error){
        console.log(error)
      }
    }
    async function editarGato(id) {
      try{
        const res = await fetch('https://649a1d4a79fbe9bcf8404b5a.mockapi.io/users/20201214010034/products')
        var listaGatos = await res.json();
        
        for(let i = 0; i < listaGatos.length; i++){
          if(listaGatos[i].id == id){
            const nome = document.querySelector('input#nomee').value = listaGatos[i].nome
            const raca = document.querySelector('input#racaa').value = listaGatos[i].raca
            const cor =  document.querySelector('input#corr').value = listaGatos[i].cor
            const idade = document.querySelector('input#idadee').value = listaGatos[i].idade
            const sexo = document.querySelector('input#sexoo').value = listaGatos[i].sexo
            const descricao = document.getElementById("descricaoo").value = listaGatos[i].descricao
          }
        }
      }catch(error){
        console.log(error)
      }

      const botaoEnviar = document.querySelector('button#botaoEnviar');
      botaoEnviar.addEventListener('click', async ()=>{
        try {
          var nome = document.getElementById("nomee").value;
          var raca = document.getElementById("racaa").value;
          var cor = document.getElementById("corr").value;
          var idade = document.getElementById("idadee").value;
          var sexo = document.getElementById("sexoo").value;
          var descricao = document.getElementById("descricaoo").value;

          var gatoEditado = {
            nome: nome,
            raca: raca,
            cor: cor,
            idade: idade,
            sexo: sexo,
            descricao: descricao
          };

          var response = await fetch(`https://649a1d4a79fbe9bcf8404b5a.mockapi.io/users/20201214010034/products/${id}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(gatoEditado)
          });
        } catch (error) {
          console.error(error);
        }
      })
      exibirGatos()
      const m = document.querySelector("#modal2");
      const modal = bootstrap.Modal.getInstance(m);
      modal.hide();
    }
    async function buscarGatos() {
      const filtro = document.querySelector("#pesquisa");
      try {
        if (filtro.value == ""){
          exibirGatos();
        }else {
          const response = await fetch('https://649a1d4a79fbe9bcf8404b5a.mockapi.io/users/20201214010034/products' + "/?nome=" + filtro.value);
          const listaGatos = await response.json();
          const caixa = document.querySelector('div.container');
          caixa.innerHTML="";
          listaGatos.forEach(gato => {
            caixa.innerHTML += `
            <div class="card mb-3" style="width: 18rem;">
              <div class="card-body  d-flex flex-column">
                <h5 class="card-title">${gato.nome}</h5>
                <ul class="list-group">
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Idade
                    <span class="badge bg-primary rounded-pill">${gato.idade}</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Sexo
                    <span class="badge bg-primary rounded-pill">${gato.sexo}</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Raça
                    <span class="badge bg-primary rounded-pill">${gato.raca}</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Cor
                    <span class="badge bg-primary rounded-pill">${gato.cor}</span>
                  </li>
                  <li class="list-group-item d-flex flex-column justify-content-between align-items-center">
                    <strong>Descrição:</strong><br>
                    <p>${gato.descricao}</p>
                  </li>
                </ul>
                <button type="button" class="btn btn-secondary mb-2 mt-2" onclick="adotar(${gato.id})">Adote</button>
                <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#modal2" onclick="editarGato(${gato.id})">Edite</button>
              </div>
          </div>
            `
          })
        }
    }catch(error) {
      alert("Ocorreu um erro")
      console.log(error)
    }
  }
  </script>
</body>
</html>
